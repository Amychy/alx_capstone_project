<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizWiz - Test Your Knowledge</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/logo.png') }}">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.15/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
    {% include "header.html" %}

    <main class="md:my-20 my-10 mx-10 md:mx-28">
        <div class="p-2.5 rounded-lg catergory-border my-0 mx-auto text-center md:w-48">
            <h1 class="uppercase black text-2xl font-bold">leaderboard</h1>
        </div>
        <section class="mt-10 overflow-auto rounded shadow-md p-6">
            <table class="leaderboard-table table-auto md:table-fixed w-full">
                <thead class="border-collapse border-b">
                    <tr class="text-left">
                        <th class="md:p-0 p-2">RANK</th>
                        <th class="md:p-0 p-2">PLAYER</th>
                        <th class="md:p-0 p-2">SCORE</th>
                        <th class="md:p-0 p-2">PLAYS</th>
                        <th class="md:whitespace-nowrap uppercase md:p-0 p-2">Most Frequent Category</th>
                    </tr>
                </thead>
                <tbody>
                    {% for idx, user in enumerated_leaderboard %}
                    <tr>
                        <td>{{ idx }}</td>
                        <td>{{ user.username }}</td>
                        <td>{{ user.total_score }}</td>
                        <td>{{ user.user_score_count }}</td>
                        <td>{{ user.most_played_category }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>                      
        </section>
    </main>

    {% include "footer.html" %}

    <script src="../static/js/hamburger.js"></script>
    <!-- Include this script block in your HTML, ideally after rendering the leaderboard table -->
<script>
    // Fetch the table and rows
    const leaderboardTable = document.querySelector('.leaderboard-table');
    const rows = leaderboardTable.querySelectorAll('tbody tr');

    // Create data structures to store accumulated scores and count
    const userScores = new Map();
    const userCounts = new Map();
    const mostFrequentCategories = new Map();

    // Process each row
    rows.forEach(row => {
        const username = row.cells[1].textContent; // Access username from the second cell

        const totalScore = parseInt(row.cells[2].textContent, 10);
        const count = parseInt(row.cells[3].textContent, 10);
        const category = row.cells[4].textContent;

        // Accumulate total scores
        userScores.set(username, (userScores.get(username) || 0) + totalScore);

        // Count the number of times the username appears
        userCounts.set(username, (userCounts.get(username) || 0) + count);

        // Determine the most frequent category
        if (!mostFrequentCategories.has(username)) {
            mostFrequentCategories.set(username, category);
        }
    });

    // Update the table content with the modified data
    rows.forEach(row => {
        const username = row.cells[1].textContent;
        row.cells[2].textContent = userScores.get(username);
        row.cells[3].textContent = userCounts.get(username);
        row.cells[4].textContent = mostFrequentCategories.get(username);
    });
</script>


</body>
</html>